<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ortan Admin - Post Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Saira:wght@400;600;700;900&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              yellow: '#D4A017',
              black: '#000000',
              white: '#FFFFFF',
              gray: '#1a1a1a'
            }
          },
          fontFamily: {
            sans: ['Garet', 'Outfit', 'sans-serif'],
            display: ['Gefika', 'Saira', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    @font-face {
      font-family: 'Gefika';
      src: url('fonts/Gefika.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-black via-brand-gray to-black text-white min-h-screen p-4 sm:p-8 font-sans">
  <div class="max-w-3xl mx-auto space-y-6">
    <header class="space-y-2">
      <p class="uppercase tracking-[0.3em] text-xs text-brand-yellow/80">Liga Ortan Admin</p>
      <h1 class="text-4xl sm:text-5xl font-display text-brand-yellow drop-shadow-[0_6px_18px_rgba(212,160,23,0.25)]">Post Match Result</h1>
      <p class="text-sm text-gray-300">Masukkan secret word dulu sebelum submit keputusan perlawanan.</p>
    </header>

    <div id="msg" class="mb-2 text-sm p-3 rounded-lg border hidden transition duration-300"></div>

    <form id="result-form" class="space-y-6 bg-brand-gray/80 backdrop-blur-sm p-6 sm:p-8 rounded-2xl shadow-2xl shadow-black/40 border border-brand-yellow/15">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <label class="block sm:col-span-2">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Secret Word</span>
          <input id="secretWord" type="password" placeholder="masukkan secret word" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner" required />
        </label>
        <label class="block">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Division</span>
          <select id="division" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner"></select>
        </label>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Home Team</span>
          <select id="homeTeam" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner"></select>
        </label>

        <label class="block">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Away Team</span>
          <select id="awayTeam" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner"></select>
        </label>
      </div>

      <div class="grid grid-cols-2 gap-6">
        <label class="block">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Home Goals</span>
          <input id="homeGoals" type="number" min="0" value="0" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner text-center font-bold" />
        </label>

        <label class="block">
          <span class="text-sm font-semibold text-gray-200 mb-1 block">Away Goals</span>
          <input id="awayGoals" type="number" min="0" value="0" class="mt-1 block w-full rounded-lg bg-black/60 p-3 border border-gray-700 focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/60 transition duration-200 text-base shadow-inner text-center font-bold" />
        </label>
      </div>

      <div class="flex flex-col sm:flex-row gap-4 pt-2">
        <button type="submit" class="group w-full sm:w-auto flex-1 bg-brand-yellow text-brand-black font-extrabold text-lg tracking-wide py-3 px-6 rounded-xl hover:bg-white transition transform duration-300 hover:scale-[1.02] shadow-xl shadow-brand-yellow/30 disabled:opacity-60 disabled:cursor-not-allowed">
          <span class="inline-block transition-transform group-hover:translate-x-1">Post Result</span>
        </button>
        <button id="refreshBtn" type="button" class="w-full sm:w-auto bg-black/60 hover:bg-black text-gray-200 font-medium py-3 px-6 rounded-xl transition duration-200 border border-gray-700">Reload Teams</button>
      </div>
    </form>

    <section class="mt-4 bg-brand-gray/80 backdrop-blur-sm p-6 rounded-2xl border border-brand-yellow/15 shadow-lg shadow-black/30">
      <h2 class="font-display text-2xl text-brand-yellow mb-3">Latest Server Response</h2>
      <pre id="response" class="text-sm text-gray-200 bg-black/70 p-4 rounded-lg overflow-x-auto border border-gray-800 transition duration-300"></pre>
    </section>
  </div>

  <script>
    const SECRET_WORD = 'azlcrib';

    function setButtonState(isSubmitting) {
      const submitButton = document.querySelector('button[type="submit"]');
      if (!submitButton) return;
      submitButton.disabled = isSubmitting;
      submitButton.innerHTML = isSubmitting ? 'Submitting...' : 'Post Result';
    }

    function showMessage(text, type = 'success') {
      const msg = document.getElementById('msg');
      msg.textContent = text;
      msg.classList.remove('hidden', 'bg-green-900/50', 'text-green-400', 'border-green-700', 'bg-red-900/50', 'text-red-400', 'border-red-700');
      if (type === 'error') {
        msg.classList.add('bg-red-900/50', 'text-red-400', 'border-red-700');
      } else {
        msg.classList.add('bg-green-900/50', 'text-green-400', 'border-green-700');
        setTimeout(() => msg.classList.add('hidden'), 4000);
      }
    }

    async function loadData() {
      const res = await fetch('/api/leaderboards');
      const data = await res.json();
      const divisions = Object.keys(data.leaderboards || {});
      const divisionSelect = document.getElementById('division');
      const current = divisionSelect.value;
      divisionSelect.innerHTML = divisions.map(d => `<option value="${d}" ${d === current ? 'selected' : ''}>${d}</option>`).join('');
      populateTeams(data, divisionSelect.value || divisions[0]);
    }

    function populateTeams(data, selectedDivision) {
      const division = selectedDivision || document.getElementById('division').value;
      const teams = (data.leaderboards && data.leaderboards[division]) || [];
      const home = document.getElementById('homeTeam');
      const away = document.getElementById('awayTeam');
      const teamMap = new Map((data.teams || []).map(t => [t.id, t.name]));
      const options = teams.map(t => `<option value="${t.teamId}">${teamMap.get(t.teamId) || t.teamId}</option>`).join('');
      home.innerHTML = options;
      away.innerHTML = options;
    }

    document.getElementById('division').addEventListener('change', async () => {
      const res = await fetch('/api/leaderboards');
      const data = await res.json();
      populateTeams(data);
    });

    document.getElementById('refreshBtn').addEventListener('click', loadData);

    document.getElementById('result-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const secret = document.getElementById('secretWord').value.trim();
      if (secret !== SECRET_WORD) {
        showMessage('Secret word salah. Result tidak dihantar.', 'error');
        return;
      }

      const division = document.getElementById('division').value;
      const homeTeamId = document.getElementById('homeTeam').value;
      const awayTeamId = document.getElementById('awayTeam').value;
      const homeGoals = parseInt(document.getElementById('homeGoals').value, 10);
      const awayGoals = parseInt(document.getElementById('awayGoals').value, 10);

      if (homeTeamId === awayTeamId) {
        showMessage('Home dan away tidak boleh sama.', 'error');
        return;
      }

      const body = { division, homeTeamId, awayTeamId, homeGoals, awayGoals };
      const headers = { 'Content-Type': 'application/json' };

      try {
        setButtonState(true);
        const res = await fetch('/api/result', {
          method: 'POST',
          headers,
          body: JSON.stringify(body)
        });
        const json = await res.json();
        document.getElementById('response').textContent = JSON.stringify(json, null, 2);
        if (json.success) {
          showMessage('Result recorded.');
          document.getElementById('homeGoals').value = 0;
          document.getElementById('awayGoals').value = 0;
        } else {
          showMessage(json.error || 'Gagal rekod result.', 'error');
        }
        loadData();
      } catch (err) {
        console.error(err);
        showMessage('Ralat semasa hantar result.', 'error');
      } finally {
        setButtonState(false);
      }
    });

    loadData().catch(err => console.error(err));
  </script>
</body>
</html>
